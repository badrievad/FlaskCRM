<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Заключение по проекту</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;600&display=swap" rel="stylesheet" />
    <link rel="icon" href="{{ url_for('crm.static', filename='/images/gpt.png') }}" type="image/png" />
    <link rel="stylesheet" href="{{ url_for('crm.static', filename='css/economic-conclusion/styles.css') }}" />
    <style>
        .styled-select {
            padding: 10px;
            font-size: 16px;
            border: none;
            background-color: transparent;
            width: 100%;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            margin: 0;
        }
        .styled-select:focus {
            outline: none;
        }
        .styled-select::after {
            content: '▼';
            position: absolute;
            right: 10px;
            pointer-events: none;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 0;
        }
        td, th {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        textarea {
            border: none;
            resize: none;
            background: transparent;
            outline: none;
            font-family: inherit;
            font-size: inherit;
            width: 99%;
            height: auto;
            overflow: hidden;
        }
        tr {
            margin-bottom: 0;
        }

        .table-wrapper {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <p>
                Приложение к протоколу заседания Инвестиционного комитета по проекту
                {{ client.name }} от 12.09.2024 г.
            </p>
        </header>

        <h1>Заключение по проекту {{ client.name }}</h1>

        <section>
            <h2>Раздел 1. Общая информация о Лизингополучателе</h2>
            <table>
                <tr>
                    <td>1.1 Наименование Лизингополучателя:</td>
                    <td>{{ client.name }}</td>
                </tr>
                <tr>
                    <td>1.2 ИНН / КПП:</td>
                    <td>{{ client.inn }} / {{ client.kpp }}</td>
                </tr>
                <tr>
                    <td>1.3 Дата государственной регистрации:</td>
                    <td>{{ client.date_of_registration.strftime('%d.%m.%Y') }}</td>
                </tr>
                <tr>
                    <td>1.4 Юридический адрес:</td>
                    <td>{{ client.address }}</td>
                </tr>
                <tr>
                    <td>1.5 Фактический адрес ведения деятельности:</td>
                    <td>{{ client.address }}</td>
                </tr>
                <tr>
                    <td>1.6 Руководитель:</td>
                    <td>{{ client.director }}</td>
                </tr>
                <tr>
                    <td>1.7 Акционеры (участники):</td>
                    <td>Либо руками писать либо с дадата сведения брать - доля 100%</td>
                    <textarea id="average-employee-count" rows="1" wrap="soft" oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px';"></textarea>
                </tr>
                <tr>
                    <td>1.8 Среднесписочная численность работников:</td>
                    <td>
                        <textarea id="average-employee-count" rows="1" wrap="soft" oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px';"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>1.9 Аффилированные лица:</td>
                    <td>
                        <textarea id="affiliates_person" rows="1" wrap="soft" oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px';"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>1.10 Сведения о ранее заключенных договорах финансовой аренды (лизинга) с ООО «ЛКМБ-РТ»</td>
                    <td>
                        <textarea id="history_dl_lkmb" rows="1" wrap="soft" oninput="adjustTextarea(this); this.style.height = this.scrollHeight + 'px';"></textarea>
                    </td>
                </tr>
                <tr>
                    <td>1.11 Статус текущей задолженности:</td>
                    <td>
                        <select id="clientStatus" class="styled-select">
                            <option value="non-problematic">Непроблемная.</option>
                            <option value="problematic">Проблемная.</option>
                        </select>
                    </td>
                </tr>
            </table>
        </section>

<div class="table-wrapper">
    <table id="additionalTable">
        <tbody>
            <tr>
                <td>
                    <table>
                        <thead>
                            <tr>
                                <td>№ и дата договора</td>
                                <td>Сумма по договору лизинга, руб.</td>
                                <td>Срок лизинга, мес.</td>
                                <td>Предмет лизинга</td>
                                <td>Среднемесячный лизинговый платеж, руб.</td>
                                <td>Остаток задолженности по договору лизинга, руб. на дату составления заключения (указать дату)</td>
                                <td>Просроченная задолженность, руб./Переплата, руб. на дату составления заключения (указать дату)</td>
                            </tr>
                        </thead>
                        <tbody id="leasingBody">
                            <tr>
                                <td>
                                    <textarea id="num_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                                <td>
                                    <textarea id="sum_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                                <td>
                                    <textarea id="time_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                                <td>
                                    <textarea id="subject_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                                <td>
                                    <textarea id="month_payment_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                                <td>
                                    <textarea id="balance_payment_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                                <td>
                                    <textarea id="delay_payment_dl_additional" rows="1" wrap="soft" oninput="adjustTextarea(this); updateTotals();"></textarea>
                                </td>
                            </tr>
                            <tr>
                                <td>Итого</td>
                                <td id="totalSum">0.00</td>
                                <td>---</td>
                                <td>---</td>
                                <td id="totalMonthlyPayment">0.00</td>
                                <td id="totalBalance">0.00</td>
                                <td id="totalDelay">0.00</td>
                            </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
        </tbody>
    </table>
    <button id="addRowButton" onclick="addRow()">Добавить строку</button>
    <button id="removeRowButton" onclick="removeRow()">Удалить</button>
</div>

<script>
    function adjustTextarea(textarea) {
        textarea.style.height = '';
        textarea.style.height = textarea.scrollHeight + 'px';

        const additionalTable = document.getElementById('additionalTable');
        const addRowButton = document.getElementById('addRowButton');
        const removeRowButton = document.getElementById('removeRowButton');

        if (textarea.value.trim().toLowerCase() === 'отсутствует') {
            additionalTable.style.display = 'none';
            addRowButton.style.display = 'none';
            removeRowButton.style.display = 'none';
        } else {
            additionalTable.style.display = 'table';
            addRowButton.style.display = 'inline-block';
            removeRowButton.style.display = 'inline-block';
        }
    }

    function addRow() {
        const leasingBody = document.getElementById('leasingBody');
        const newRow = leasingBody.insertRow(leasingBody.rows.length - 1); // Добавляем перед строкой "Итого"
        
        for (let i = 0; i < 7; i++) {
            const newCell = newRow.insertCell(i);
            const textarea = document.createElement("textarea");
            textarea.rows = 1;
            textarea.wrap = "soft";
            textarea.oninput = function() {
                adjustTextarea(this);
                updateTotals();
            };
            newCell.appendChild(textarea);
        }
    }

    function removeRow() {
        const leasingBody = document.getElementById('leasingBody');
        if (leasingBody.rows.length > 2) { // Убедитесь, что остается хотя бы одна строка ввода
            leasingBody.deleteRow(leasingBody.rows.length - 2); // Удаляем последнюю добавленную строку
            updateTotals(); // Обновляем итоги после удаления
        }
    }

    function updateTotals() {
        const rows = document.querySelectorAll("#leasingBody tr");
        let totalSum = 0;
        let totalMonthlyPayment = 0;
        let totalBalance = 0;
        let totalDelay = 0;

        rows.forEach((row, index) => {
            if (index === rows.length - 1) return; // Пропускаем строку "Итого"
            const cells = row.querySelectorAll("textarea");
            if (cells[1].value) totalSum += parseFloat(cells[1].value.replace(/[^0-9.-]+/g, "")) || 0;
            if (cells[4].value) totalMonthlyPayment += parseFloat(cells[4].value.replace(/[^0-9.-]+/g, "")) || 0;
            if (cells[5].value) totalBalance += parseFloat(cells[5].value.replace(/[^0-9.-]+/g, "")) || 0;
            if (cells[6].value) totalDelay += parseFloat(cells[6].value.replace(/[^0-9.-]+/g, "")) || 0;
        });

        document.getElementById("totalSum").innerText = totalSum.toFixed(2);
        document.getElementById("totalMonthlyPayment").innerText = totalMonthlyPayment.toFixed(2);
        document.getElementById("totalBalance").innerText = totalBalance.toFixed(2);
        document.getElementById("totalDelay").innerText = totalDelay.toFixed(2);
    }
</script>




        <section>
            <h2>Раздел 2. Операционно-хозяйственная деятельность Лизингополучателя</h2>
            <table>
                <tr>
                    <td>2.1 Отраслевая принадлежность и основные виды продукции (услуг):</td>
                    <td>47.19 Торговля розничная прочая в неспециализированных магазинах.</td>
                </tr>
                <tr>
                    <td>2.2 Описание бизнеса Лизингополучателя</td>
                    <td>Общество создано в марте 2016 года. ООО «КрепежСнаб». Основным видом деятельности, согласно выписке из ЕГРЮЛ является  Торговля розничная прочая в неспециализированных магазинах, в том числе компания осуществляет деятельность по дополнительному виду деятельности согласно ОКВЭД 49.41 Деятельность автомобильного грузового транспорта.
                        На приобретаемом автомобиле планируется оказание услуг по откачке канализационных стоков в частном секторе г. Азнакаево, Азнакаевского района,  г. Бугульма, Бугульминского района.
                    </td>
                </tr>
                <tr>
                    <td>2.3 Предоставленные договоры с контрагентами в подтверждение текущей деятельности</td>
                    <td>-</td>
                </tr>
                <tr>
                    <td colspan="2">
                        <table>
                            <thead>
                                <tr>
                                    <td><strong>Лизингополучатель является исполнителем по следующим договорам:</strong></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <table>
                                            <thead>
                                                <tr>
                                                    <td>П/п</td>
                                                    <td>Договор №</td>
                                                    <td>Контрагент</td>
                                                    <td>ИНН</td>
                                                    <td>Дата заключения договора</td>
                                                    <td>Предмет договора</td>
                                                    <td>Стоимость</td>
                                                    <td>Дата окончания договора</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>1.</td>
                                                    <td>№30112023/1</td>
                                                    <td>Контрагент 1</td>
                                                    <td>1234567890</td>
                                                    <td>01.01.2024</td>
                                                    <td>Предмет 1</td>
                                                    <td>1000000</td>
                                                    <td>01.01.2025</td>
                                                </tr>
                                                <!-- Добавьте другие строки по необходимости -->
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>
    </section>
</div>
</body>
</html>
